{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/antoniomiguel/Documents/projectos/Barza_landing/app/api/blog/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nconst FEEDS_BY_CATEGORY: Record<string, string[]> = {\n  grooming: [\"https://www.gq.com/feed/style.xml\", \"https://www.menshealth.com/rss/all.xml\"],\n  skincare: [\"https://www.allure.com/feed/all\", \"https://www.healthline.com/feed\"],\n  fashion: [\"https://www.vogue.com/rss.xml\", \"https://www.highsnobiety.com/feed\"],\n  wellness: [\"https://www.nytimes.com/services/xml/rss/nyt/Well.xml\", \"https://www.psychologytoday.com/intl/rss.xml\"],\n  inspiration: [\"https://www.theguardian.com/world/rss\", \"https://www.nationalgeographic.com/content/nationalgeographic/en/rss\"],\n  angola: [\n    // Feeds angolanos que pudeste encontrar\n    \"https://angola24horas.com/index.php/lifestyle/itemlist/category/49-moda-e-beleza\",  \n    \"https://noticiasdeangola.co.ao/feed\"\n    // podes adicionar mais se encontrares\n  ],\n};\n\nconst ALL_FEEDS = Array.from(new Set(Object.values(FEEDS_BY_CATEGORY).flat()));\n\nconst BARZA_KEYWORDS = [\n  \"hair\", \"hairstyle\", \"cabelo\", \"barber\", \"barbearia\", \"beleza\", \"beauty\",\n  \"skin\", \"skincare\", \"makeup\", \"moda\", \"fashion\", \"grooming\", \"unhas\", \"lifestyle\"\n];\n\nasync function parseXMLString(xmlString: string) {\n  const { JSDOM } = await import(\"jsdom\");\n  const parser = new JSDOM(xmlString, { contentType: \"text/xml\" });\n  return parser.window.document;\n}\n\nfunction extractImageFromItem(item: Element): string | null {\n  const enclosure = item.querySelector(\"enclosure[url]\");\n  if (enclosure) return enclosure.getAttribute(\"url\");\n  const mediaContent = item.getElementsByTagNameNS(\"*\", \"content\")[0];\n  if (mediaContent?.getAttribute) return mediaContent.getAttribute(\"url\");\n  const description = item.querySelector(\"description\")?.textContent || \"\";\n  const imgMatch = description.match(/<img[^>]+src=[\"']([^\"']+)[\"']/i);\n  return imgMatch ? imgMatch[1] : null;\n}\n\nfunction normalizeItem(item: Element, categoryKey: string, feedTitle?: string) {\n  const title = item.querySelector(\"title\")?.textContent?.trim() || \"Sem título\";\n  const link = item.querySelector(\"link\")?.textContent?.trim()\n    || item.querySelector(\"guid\")?.textContent?.trim()\n    || \"\";\n  const pubDate = item.querySelector(\"pubDate\")?.textContent?.trim() || null;\n  const excerpt = (item.querySelector(\"description\")?.textContent || \"\")\n    .replace(/<\\/?[^>]+(>|$)/g, \"\")\n    .trim();\n  const image = extractImageFromItem(item);\n  const id = link || `${title}-${pubDate || Math.random().toString(36).slice(2, 7)}`;\n\n  return {\n    id,\n    title,\n    excerpt: excerpt ? (excerpt.length > 200 ? excerpt.slice(0, 200) + \"…\" : excerpt) : undefined,\n    content: excerpt,\n    image: image || null,\n    category: categoryKey,\n    link,\n    source: feedTitle || null,\n    publishedAt: pubDate,\n  };\n}\n\nfunction isRelevantToBarza(item: any): boolean {\n  const text = `${item.title} ${item.excerpt}`.toLowerCase();\n  return BARZA_KEYWORDS.some(kw => text.includes(kw.toLowerCase()));\n}\n\nasync function fetchFeed(url: string, categoryKey: string) {\n  try {\n    const res = await fetch(url);\n    const text = await res.text();\n    const doc = await parseXMLString(text);\n    const channelTitle = doc.querySelector(\"channel > title\")?.textContent?.trim() || null;\n    const items = Array.from(doc.querySelectorAll(\"item\"));\n    return items.map(it => normalizeItem(it, categoryKey, channelTitle));\n  } catch (err) {\n    console.error(\"Error fetching feed:\", err);\n    return [];\n  }\n}\n\nexport async function GET(req: Request) {\n  const { searchParams } = new URL(req.url);\n  const category = searchParams.get(\"category\") || \"all\";\n\n  const feedUrls = category === \"all\"\n    ? ALL_FEEDS\n    : FEEDS_BY_CATEGORY[category] || [];\n  if (feedUrls.length === 0) {\n    return NextResponse.json({ error: \"Categoria inválida\" }, { status: 400 });\n  }\n\n  const results = await Promise.all(feedUrls.map(url => fetchFeed(url, category)));\n  const merged = results.flat();\n\n  // filtra só os relevantes\n  const filtered = merged.filter(isRelevantToBarza);\n\n  // remove duplicados\n  const map = new Map<string, any>();\n  for (const art of filtered) {\n    if (!map.has(art.id)) map.set(art.id, art);\n  }\n  const finalArr = Array.from(map.values());\n\n  // ordena por data\n  finalArr.sort(\n    (a, b) =>\n      (b.publishedAt ? Date.parse(b.publishedAt) : 0) -\n      (a.publishedAt ? Date.parse(a.publishedAt) : 0)\n  );\n\n  return NextResponse.json(finalArr);\n}\n"],"names":[],"mappings":"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"}}]
}